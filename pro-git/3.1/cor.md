# 3.1 브랜치 소개

## 학습목표
- 브랜치의 개념을 이해한다.
- HEAD가 무엇인지 이해한다.
- add, commit 했을 때 내부적으로 무슨 일이 일어나는지 파악한다.

**브랜칭**이란 주된 개발 흐름에서 분기해서 **별도로 작업하는 것**을 말한다.

브랜치는 git의 **죽여주는 기능[killer feature]**이기 때문에, 브랜치를 잘 이해하고 쓰는 것은 프로그래머에게 있어 아주 강력하고 특별한 도구가 되며, 개발하는 방식을 전적으로 바꿀 것이다.

## 브랜치를 이해하기 전에 알아야 될 팩트 모음

- git은 데이터를 “일련의 변화 모음”으로 저장하지 않고, **일련의 “스냅샷”**으로 저장함.
- 파일을 **stage하면** 다음의 일이 일어난다:
    - 해당 파일의 **checksum을 계산**한다. ⇒ 즉, SHA-1 해시.
    - 그 파일의 해당 버전을 깃 레포지토리에 **저장**한다. ⇒ 이 저장된 것을 **`blob`** 이라고 부름.
    - 해당 체크섬을 **stage 영역에** 더한다.
- **커밋을 하면**, 다음의 일이 일어난다:
    - git은 **subdirectory(들)을 checksum**하고 그 결과를 **트리 객체로 저장**한다.
        - 이러한 트리 객체 내에 **내가 stage한 내용의 스냅샷(blob)을 가리키는 포인터**들이 있음
    - 그리고 **커밋 객체**를 생성하는데, 이 커밋 객체에 들어있는 것은 다음과 같다:
        - **root 프로젝트 트리**를 가리키는 포인터
        - 커밋에 대한 **메타데이터**
            - 커밋한 사람의 이름과 이메일 주소
            - 커밋 메시지
            - 이 커밋의 **바로 직전에 있던 커밋(들)을 가리키는 포인터** ⇒ 즉 부모 커밋
                - 맨 처음 만든 커밋은 부모 커밋이 0개
                - 일반적인 커밋은 부모 커밋이 1개
                - 2개 이상의 브랜치의 병합에 의해 생긴 커밋은 부모 커밋이 다수
- 각각의 객체에 들어있는 정보는 다음과 같다:
    - blob 객체 ⇒ 파일의 내용을 나타낸다.
    - 트리 객체
        - 특정 디렉토리 내에 무슨 파일들이 들어있는지
        - 어떤 파일명이 어떤 blob으로 저장되어 있는지
    - 커밋 객체
        - root 트리를 가리키는 포인터
        - 커밋 메타데이터

## 그래서 브랜치가 도대체 뭐지?

브랜치는 단순하게, **커밋들 중 하나를 가리키는 경량의 이동가능한 포인터**이다.

**⇒ 자신이 가리키고 있는 커밋의 길이 40의 SHA-1 체크섬을 포함하고 있는 파일임.**

깃에서 기본적으로 주어지는 커밋의 이름은 master 혹은 main이다. (그렇다고 해서 특별한 브랜치인건 아님.)

커밋을 하면 **마지막으로 만든 커밋을 가리키는** master 브랜치를 얻게 된다.

커밋을 할 때마다 master 브랜치는 **자동적으로 앞으로 이동**한다.

## 새 브랜치 생성하기

`git branch <name>` 을 하면 새로운 포인터가 생기는 것이다.

여기서 `HEAD` 의 개념이 등장한다. `HEAD` 란 특별한 포인터로, 내가 현재 어떤 브랜치에 있는지를 가리킨다.

브랜치 포인터가 뭘 가리키고 있는지 보려면 `git log --decorate` 하면 된다.

참고: `--decorate=full, short, auto, no`

## 브랜치 이동하기

`git checkout <branch>` 하면 **HEAD가 해당 브랜치를 가리키도록 만든다. 그리고 그 브랜치가 가리키고 있는 스냅샷의 파일 상태로 working directory를 되돌린다.** 만약 작업영역을 clean하게 되돌릴 수 없으면 다른 브랜치로 switch할 수 없다.

참고: `git log` 는 기본적으로 모든 브랜치를 보여주지 않음. 현재 위치한 브랜치 이하에 있는 커밋 히스토리만 보여줌. 특정 브랜치의 커밋 히스토리를 보고 싶으면 `git log <branch>` 로 명시적으로 지정해줘야 한다. 모든 브랜치를 다 보고 싶으면 `git log --all` 해야 한다.

**히스토리가 분기[divergent]된 것을 시각적으로 확인하려면 `git log --oneline --decorate --all --graph` 하면 된다.**

브랜치를 만드는것은 저렴한 작업인데다 커밋할때 부모 커밋을 기록하고 있으므로 적절한 merge base를 찾는 것은 쉬운 일임.

**브랜치를 만듦과 동시에 이동하려면 ⇒ `git checkout -b <branch>`**

깃 2.23버전에서 `git switch` 가 새로 나왔으며 `git checkout` 대신 쓸 수 있음.

- 특정 브랜치로 이동 ⇒ `git switch <branch>`
- 새 브랜치 만듦과 동시에 이동 ⇒ `git switch -c <branch>` 혹은 `--create`
- 이전에 체크아웃했던 브랜치로 가기 ⇒ `git switch -`