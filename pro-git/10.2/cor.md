# 10.2 깃 오브젝트

## 학습목표
- 깃에 자료들이 어떻게 내부적으로 저장되는지 이해한다.

## 들어가며
- git은 **content-addressable 파일시스템**이라고 한 바 있음
   - 이 말의 골자는 git은 **key-value 데이터 저장소**라는 것임
   - 깃에 뭔갈 넣으면, 나중에 그걸 찾아볼수 있는 **고유한 key**를 줌
- `git hash-object`
   - 데이터를 취해 `.git/objects` 디렉토리(즉, object database)에 저장
   - 저장한 데이터를 나타내는 고유한 key 리턴
   - 아무런 옵션 없이 파일명만 인자로 제공하면, 그 파일의 내용을 "나타냈을" 고유한 키를 반환
   - `-w` 옵션을 줘야 실제로 데이터베이스에 저장
   - `--stdin` 옵션을 주면 stdin으로부터 파일 내용을 취함
   - 제공한 파일 내용과 추가적인 헤더에 대한 40자리 SHA-1 체크섬 해시값
- 이렇게 저장된 데이터의 유형을 **blob**이라고 하며, git이 데이터를 맨 처음 저장하는 방식
   - 데이터당 하나의 파일로
   - 파일 내용+헤더의 SHA-1 체크섬이 key
   - 서브디렉토리명은 체크섬의 첫 2글자
   - 파일명은 나머지 38글자
- `git cat-file`
   - object database에 있는 데이터 검사하기 위한 다용도 명령어
   - `-p` 옵션을 주면 데이터의 유형을 파악한 뒤 적절하게 표시하도록 함
   - `-t` 옵션을 주면 데이터의 유형을 출력함

## 트리 객체
- tree는 하나 이상의 entry로 구성되며, 각 entry는 blob 혹은 tree임
- 비유하자면 blob은 파일이고 tree는 디렉토리
- 각각의 entry는 SHA-1 해시이며 모드, 유형, 파일명을 가짐
- `branch^{tree}` 구문을 통해 해당 branch에 있는 마지막 커밋의 tree 객체를 명시할 수 있음
- 깃은 통상적으로 index의 상태를 취한 뒤 그것으로부터 tree 객체를 작성함으로써 tree를 생성함
- index를 만드려면 `git update-index <mode> <SHA-1> <filename>` 명령어를 사용
   - 인덱스에 아직 존재하지 않는 파일이라면 `--add` 옵션 명시 필요
   - 파일이 디렉토리에 있는게 아니라 데이터베이스에 있다면 `--cacheinfo` 옵션 명시 필요
- 여러가지 mode가 있음
   - blob의 경우 총 3개의 mode 존재 => `100644`(통상파일), `100755`(실행파일), `120000`(심볼릭링크)
   - 디렉토리와 서브모듈도 별도의 mode를 가지는 듯
- `git write-tree`
   - index의 상태를 tree 객체에 작성(혹은 기록)할 수 있음
   - 자동적으로 인덱스의 상태로부터 트리를 만듦 (이 트리가 존재하지 않는다면)
- `git read-tree`
   - `--prefix` 옵션을 통해 존재하는 트리를 인덱스에 subtree로 읽을 수 있음
- 요컨대 트리는 프로젝트의 "스냅샷"을 의미하는 듯

## 커밋 객체
- 커밋 객체는 스냅샷의 SHA-1, 누가 언제 왜 이 스냅샷을 저장했는지에 대한 정보를 가지고 있음
- `git commit-tree <tree-hash> [-p <parent-commit>]`
   - 커밋 객체 생성
- 커밋 객체에 대해 cat-file하면 해당 시점의 프로젝트의 스냅샷에 대한 top-level tree 및 각종 정보가 나옴

## 객체 보관
- 위에서 말한 헤더 => `<obj-type> <data-bytesiz>\0`
- 이 헤더와 원래 데이터를 concat한 것의 SHA-1을 구함
- 헤더+데이터를 zlib으로 압축
- SHA-1의 첫 2글자를 subdir로 하고 나머지 38글자를 filename으로 해서 압축된 헤더+데이터를 저장
- 모든 깃 데이터는 같은 방식으로 저장되며 단지 유형이 다를 뿐임
- blob 데이터는 거의 아무거나일 수 있지만 commit과 tree의 데이터는 아주 구체적으로 format됨

## 기타
- `find` 프로그램은 디렉토리 위계 내에서 파일을 탐색하는 프로그램
   - `-type f` 라는 말의 뜻은 regular file을 찾으라는 뜻인 듯

## 영어 공부
- predictably[프리딕터블리]: 예상하던 대로
- oddly enough: 이상하게도
