# 7.7 Git Tools - Reset Demystified

## 세 가지 트리

- HEAD: 브랜치의 마지막 커밋의 스냅샷
  - 현재 브랜치 참조에 대한 포인터
- 인덱스: 다음 커밋으로 제안된 스냅샷
  - `git commit`을 실행할 때 Git이 이용하기 때문에 Staging Area라고도 부름
  - 작업 디렉토리에 가져온 모든 파일의 내용과 그 당시 상태를 기록
  - 기술적으로는 트리가 아니고 평면화된 manifest로 구현되어 있음
- 작업 디렉토리: 작업 영역. 샌드박스
  - 작업 트리와 같은 말
  - 다른 트리와 달리 `.git` 외부로 풀어 편집하기 쉽게 만듦.
  - 샌드박스처럼 인덱스와 히스토리에 커밋하기 전에 변경사항을 시도할 수 있음.

### 작업 흐름

- `git add`: 작업 디렉토리의 내용을 가져와 인덱스에 복사
- `git commit`:
  1. 인덱스의 내용을 가져와 영구 스냅샷으로 저장
  2. 그 스냅샷을 가리키는 커밋 객체 생성
  3. 현재 브랜치가 그 커밋을 가리키도록 업데이트
- `git status`: 세 트리를 비교해서 다른 파일을 출력

## Reset

- `git reset [--soft | --mixed | --hard] [<commit>]`
- 모든 형태에서 `<commit>`과 `<tree-ish>`는 기본적으로 HEAD임
- reset은 다음 순서대로 실행됨

1. HEAD가 가리키는 브랜치를 이동 (`--soft`는 여기서 중단. 마지막 `git commit`을 취소한 것과 같음)
2. HEAD가 가리키는 스냅샷의 내용으로 인덱스를 업데이트 (`--mixed`는 여기서 중단. `git commit`과 `git add`를 취소한 것과 같음)
3. 작업 디렉토리를 인덱스처럼 보이게 만듦 (`--hard`시 여기까지 실행. `git commit`, `git add`, 작업한 것까지 취소. 즉 작업한 것을 잃을 수 있음)

- 간단한 squash: `git reset --soft <유지하려는 가장 최근 커밋>` 후 `git commit` 실행

### 경로가 있는 reset

- `git reset [<tree-ish>] [--] <pathspec>...`
- `<tree-ish>`의 항목들을 인덱스로 복사
- `--patch`로 hunk 단위로 unstage 가능

## Checkout

### 경로가 없다면

- HEAD 자체를 이동시킴
- HEAD가 가리키는 스냅샷의 내용으로 인덱스를 업데이트
- 작업 디렉토리 안전. 사소한 병합을 시도. 변경하지 않은 모든 파일이 업데이트 됨.

### 경로가 있다면

- 해당 파일들의 인덱스와 작업 디렉토리를 HEAD로 만듦
- 작업 디렉토리 안전하지 않음. HEAD도 이동하지 않음
- `--patch`도 가능
