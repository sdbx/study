# 8.3 Customizing Git - Git Hooks

## 훅

- 액션이 발생할 때 실행하는 커스텀 스크립트
- `.git/hooks`에 저장
- 정확한 이름을 가져야 하고, 확장자가 없어야하고, 실행 가능해야함

### 클라이언트 측 훅

- 클론할 때 복사되지 않음

#### 커밋 라이프사이클

1. `pre-commit`: 커밋 메시지 입력 전
  - 0이 아닌 종료 코드로 중단 가능
  - 용례: 정적 분석 도구 실행
2. `prepare-commit-msg`: 기본 메시지 생성 후, 커밋 메시지 편집기 실행 전
  - 인자: 커밋 메시지가 담긴 파일 경로, 커밋 종류, amend 커밋이라면 커밋 해시
  - 용례: 기본 메시지가 자동생성 되는 경우 유용
3. `commit-msg`: 커밋 메시지 편집기 종료 후
  - 인자: 개발자가 작성한 커밋 메시지를 담은 임시 파일의 경로
  - 0이 아닌 종료 코드로 중단 가능
  - 용례: 커밋 전 프로젝트 상태나 커밋 메시지 검증에 이용
4. `post-commit`: 전체 커밋 프로세스가 완료된 후
  - 인자는 없지만 `git log -1 HEAD`로 마지막 커밋을 가져올 수 있음
  - 용례: 알림

#### 이메일 워크플로우

1. `applypatch-msg`: `git am` 실행시
  - 인자: 커밋 메시지가 담긴 임시 파일 이름
  - 0이 아닌 종료 코드로 중단 가능
  - 용례: 커밋 메시지 형식 확인, 커밋 메시지 수정
2. `pre-applypatch`: 패치가 적용된 후, 커밋이 만들어지기 전
  - 0이 아닌 종료 코드로 중단 가능
  - 용례: 스냅샷 검토, 테스트 실행, WD 확인
3. `post-applypatch`: 커밋이 만들어진 뒤 실행

- 용례: 알림

#### 그 외

- `pre-rebase`: rebase 전
  - 0이 아닌 종료 코드로 중단 가능
  - 용례: 이미 푸시한 커밋 rebase를 막기(샘플)
- `post-rewrite`: `git commit --amend`, `git rebase` 등 커밋을 대체할 때 실행
  - 인자: 트리거 한 명령
  - stdin: rewrite 목록
- `post-checkout`: `git checkout` 성공 후
  - 용례: 프로젝트 환경에 맞게 WD 세팅, 소스 관리에 포함하고 싶지 않은 대용량 바이너리 파일 배치, 문서 자동 생성
- `post-merge`: 병합 성공 후
  - 용례: Git이 추적하지 않는 데이터를 복구, WD가 변경될 때 복사하고 싶은 Git 외부 파일 존재 여부를 검증
- `pre-push`: `git push` 도중, 원격 참조가 업데이트 된 후, 객체가 전송되기 전
  - 인자: 원격 이름, 원격 위치
  - stdin: 업데이트 될 참조 목록
  - 0이 아닌 종료 코드로 중단 가능
  - 용례: 참조 업데이트 검증
- `pre-auto-gc`: GC 발생 전
  - 0이 아닌 종료 코드로 중단 가능
  - 용례: 알림, 중단

### 서버 측 훅

1. `pre-receive`: 푸시 처리시
  - stdin: 푸시 대상 참조 목록
  - 0이 아닌 종료 코드로 중단 가능
  - 용례: non-fast-forward 확인, 수정되는 모든 참조와 파일의 접근 제어
2. `update`: 각 브랜치마다 실행
  - 인자: 참조(브랜치) 이름, 참조가 가리키던 해시, 푸시하려는 해시
  - 0이 아닌 종료 코드로 중단 가능(해당 참조만 중단)
3. `post-receive`: 전체 과정이 완료된 후
  - stdin: 푸시 대상 참조 목록
  - 용례: 메일링 리스트로 이메일 전송, CI 서버에 전달, 티켓 추적 시스템 업데이트
  - 주의: 완료될 때까지 클라이언트 연결을 끊지 않음

## 팁

스크립트의 명령줄 플래그는 축약형보다 긴 형태를 권장.
