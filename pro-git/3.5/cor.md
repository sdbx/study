# 3.5 원격 브랜치
이 장에는 몰랐던 내용이 많으므로 주의깊게 학습하기로 한다.

## 학습목표
- 원격 브랜치와 원격 추적 브랜치의 개념을 이해한다.
- 원격 추적 브랜치를 설정하는 방법을 숙지한다.

## 원격 브랜치와 원격 추적 브랜치
- 원격 레퍼런스[remote reference]란 원격 레포지토리에 있는 레퍼런스(혹은 포인터)임.
   - 원격 레퍼런스에는 브랜치, 태그 등이 있음.
- 원격 추적 브랜치[remote-tracking branch]란 원격 브랜치의 상태에 대한 레퍼런스임.
   - 원격 추적 브랜치는 local 레퍼런스이며 **내가 직접 움직일 수 없음**.
   - 네트워크 커뮤니케이션이 있을 때마다 git이 알아서 관리함.
   - 비유하자면 원추브랜치는 책갈피로, 마지막에 원격 레포지토리와 통신했을 때 원격 브랜치들이 어디 있었는지를 나타낸다.
   - 원추브랜치의 이름은 `<remote>/<branch>` 의 형식을 가지고 있다.
   - 후술할 fetch를 해서 원격으로부터 새로운 원추브랜치가 생겼다고 해도, 자동적으로 수정가능한 로컬 브랜치가 생기는 것은 아니다.
   - 원추브랜치의 내용을 현재 위치한 로컬 브랜치에 합치려면 `git merge <remote>/<branch>` 해야 한다.
   - 원추브랜치를 기반으로 로컬브랜치를 만들 수 있음. 그러려면 `git checkout -b <localname> <remote>/<remotename>` 해야 함. 이러면 원추브랜치가 있는 곳에 로컬브랜치가 생김.

```
# 원격 레퍼런스 리스트 출력
git ls-remote <remote>

# 원격 브랜치 및 기타 정보 확인
git remote show <remote>

# 클론할때 remote 이름 다르게 지정하기. --origin <name> 으로도 가능.
git clone -o backdoor <url>
```

생각: 브랜치의 종류는 4가지? 그냥 로컬브랜치, 추적 로컬브랜치, 원추브랜치 (얘도 위치는 로컬), 원격브랜치

## fetch란?
원격 레포지토리와 로컬을 동기화하기 위해서 `git fetch <remote>` 를 수행한다.
- `<remote>` 가 무슨 서버인지 찾아본다.
- 거기로부터 로컬에는 아직 없는 데이터를 가져온다[fetch].
- 로컬 데이터베이스를 갱신한다.
- 원추브랜치를 최신 위치로 갱신한다.

## push syntax
`git push origin bugfix` 의 bugfix 부분은 축약된 것인데 확장되면 `refs/heads/bugfix:refs/heads/bugfix` 가 된다. 이 말의 뜻은 로컬에 있는 bugfix 브랜치로 원격에 있는 bugfix 브랜치를 갱신하라는 뜻이다. `bugfix:bugfix` 로 쓸 수도 있다. 의미는 같다.

## 여러가지 단어의 뜻
### 추적[track]과 업스트림
원추브랜치로부터 로컬브랜치를 checkout하는 것은 자동적으로 **"추적 브랜치"** 라는 것을 생성함. 추적 브랜치가 추적하는 브랜치를 **"업스트림 브랜치"** 라고 함. **추적 브랜치란 원격 브랜치와 직접적인 관계를 가지고 있는 로컬 브랜치를 뜻함.** 추적 브랜치에 위치하고 있을 때 `git pull` 을 하면 git은 어떤 서버에서 fetch해와야 하는지, 어떤 브랜치를 merge해야 하는지 알고 있음.

```
# 다음의 명령어를 치면 추적 브랜치가 생김.
# 꼭 원격과 같은 이름일 필요는 없는듯.
git checkout -b mybranch remote/mybranch
git checkout --track remote/mybranch
git checkout mybranch      # 단, 이 명령어의 경우 기존에 이 이름으로 된 (로컬이겠지?) 브랜치가 없고, 오직 하나의 원격에서만 이름이 일치할 때 가능함.

# 기존에 있는 로컬브랜치가 원격브랜치를 추적하게 하고싶거나,
# 기존 업스트림 브랜치를 변경하고 싶다면
git branch -u remote/branch   # -u 대신 --set-upstream-to 도 가능함.
```

추적 브랜치의 업스트림 브랜치를 `@{upstream}` 혹은 `@{u}` 로 지칭할 수 있음. 예시로, `git merge origin/master` 대신 `git merge @{u}` 가 가능함.

내가 가지고 있는 추적브랜치를 보려면 `git branch -vv` 옵션으로 가능하다.

### ahead와 behind
**ahead라는 말의 뜻은 로컬에 서버에 아직 push되지 않은 커밋이 있다는 뜻이다. 반면, behind라는 말의 뜻은 서버에 아직 로컬으로 병합하지 않은 커밋이 있다는 뜻이다.** 주의할 점은 이 숫자들은 내가 마지막으로 서버와 통신했을때의 기록이기 때문에, 최신의 기록을 원한다면 먼저 `git fetch --all; git branch -vv` 같은 식으로 해야 할 것이다.

## pull 명령어가 하는 일
`git fetch` 는 서버로부터 내가 아직 가지고 있지 않은 데이터를 가져오기만 할 뿐, 로컬의 working directory를 변경하지는 않는다. 한마디로 merge를 직접 해야 하는 것이다 (필요하다면). 반면, `git pull` 은 본질적으로 `git fetch` 에 뒤따르는 `git merge` 이다 (대부분의 경우 => 그럼 아닌 경우도 있다는거임?)

## 원격 브랜치 삭제하는 방법
`git push <remote> --delete <branch>` 를 하면 된다. 서버로부터 포인터가 삭제된다. git 서버는 일반적으로 가비지 콜렉터가 작동하기 전까지 데이터를 잠시동안 유지하므로 데이터가 실수로 삭제되었다 하더라도 복구할수도 있다는 듯함.